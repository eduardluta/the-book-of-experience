<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Book of Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500&family=Caveat:wght@400;500;600&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Turn.js specific styles - A4 ratio 1:1.414 */
        #flipbook {
            width: 848px;   /* Two pages side by side: 424px * 2 */
            height: 600px;  /* 424 * 1.414 ≈ 600 */
            margin: 0 auto;
            position: relative;
        }
        #flipbook > div {
            background: linear-gradient(to bottom, #f5f0e6 0%, #fdfbf7 3%, #fdfbf7 97%, #f5f0e6 100%);
            position: relative;
        }
        /* Left page - shadow on right edge (center fold) */
        #flipbook > div:nth-child(odd):not(.hard) {
            box-shadow:
                inset -15px 0 20px -10px rgba(0,0,0,0.15),
                inset 5px 0 10px -5px rgba(0,0,0,0.05);
            border-right: 1px solid rgba(0,0,0,0.1);
        }
        /* Right page - shadow on left edge (center fold) */
        #flipbook > div:nth-child(even):not(.hard) {
            box-shadow:
                inset 15px 0 20px -10px rgba(0,0,0,0.15),
                inset -5px 0 10px -5px rgba(0,0,0,0.05);
            border-left: 1px solid rgba(0,0,0,0.1);
        }
        /* Outer edge shadows */
        .flipbook-container {
            position: relative;
        }
        #flipbook {
            box-shadow:
                -5px 0 15px -5px rgba(0,0,0,0.2),
                5px 0 15px -5px rgba(0,0,0,0.2),
                0 10px 30px -10px rgba(0,0,0,0.3);
        }
        /* Center spine effect */
        #flipbook::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 6px;
            transform: translateX(-50%);
            background: linear-gradient(to right,
                rgba(0,0,0,0.1) 0%,
                rgba(0,0,0,0.2) 30%,
                rgba(0,0,0,0.25) 50%,
                rgba(0,0,0,0.2) 70%,
                rgba(0,0,0,0.1) 100%
            );
            pointer-events: none;
            z-index: 1000;
        }
        #flipbook .page-content {
            padding: 2.5rem;
            height: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        #flipbook .hard {
            background: linear-gradient(135deg, #4a3228 0%, #5c4033 20%, #6b4c35 50%, #5c4033 80%, #4a3228 100%) !important;
            color: #d4af37;
            box-shadow:
                inset 0 0 50px rgba(0,0,0,0.4),
                inset 0 0 10px rgba(212,175,55,0.15),
                0 4px 15px rgba(0,0,0,0.3);
        }
        #flipbook .hard::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 3px solid rgba(212,175,55,0.6);
            border-radius: 4px;
            pointer-events: none;
            box-shadow:
                0 0 10px rgba(212,175,55,0.3),
                inset 0 0 10px rgba(212,175,55,0.1);
        }
        #flipbook .hard .page-content {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
        }
        #flipbook .hard h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            line-height: 1.6;
            letter-spacing: 0.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #flipbook .cover-front {
            border-radius: 0 8px 8px 0;
        }
        #flipbook .cover-back {
            border-radius: 8px 0 0 8px;
        }
        /* Smoother page transitions */
        #flipbook .turn-page {
            transition: transform 0.1s ease-out;
        }
        .flipbook-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }
        #flipbook .page-question {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            font-weight: 500;
            color: #1a1a2e;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        #flipbook .page-answer {
            font-family: 'Caveat', cursive;
            font-size: 1.15rem;
            color: #2d3748;
            line-height: 1.8;
            white-space: pre-line;
        }
        #flipbook .page-author {
            font-family: 'Libre Baskerville', serif;
            font-style: italic;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 1.5rem;
        }
        /* Hide default book on larger screens when flipbook is active */
        @media (min-width: 900px) {
            .book-wrapper .book {
                display: none;
            }
            .flipbook-container {
                display: flex;
            }
        }
        @media (max-width: 899px) {
            .flipbook-container {
                display: none;
            }
            .book-wrapper .book {
                display: grid;
            }
        }
    </style>
</head>
<body>

    <div id="header"></div>

    <main>
        <section class="intro">
            <span class="section-label">Introduction</span>
            <p>
                Some experiences change everything—how we see the world, what we believe, who we become. Some fears do the same. This is where those stories live. A collaborative space for the moments that shaped us, shared for the ones still being shaped.
            </p>
        </section>

        <section class="book-section">
            <div class="container">
                <div class="book-wrapper">
                    <!-- Flipbook for larger screens -->
                    <div class="flipbook-container">
                        <div id="flipbook">
                            <!-- Pages will be generated dynamically -->
                        </div>
                    </div>

                    <!-- Fallback for mobile/smaller screens -->
                    <article class="book" id="book">
                        <div class="spine"></div>

                        <div class="page">
                            <h2 class="page-question">What is the best experience you would gift someone?</h2>
                            <p class="page-answer" id="experience-text"></p>
                            <p class="page-author" id="author-left"></p>
                        </div>

                        <div class="page">
                            <h2 class="page-question">What is your biggest fear?</h2>
                            <p class="page-answer" id="fear-text"></p>
                            <p class="page-author" id="author-right"></p>
                        </div>
                    </article>

                    <div class="book-nav">
                        <button class="nav-btn prev-story" id="prev-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            Previous
                        </button>
                        <button class="nav-btn next-story" id="next-btn">
                            Next Story
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="purpose">
            <span class="section-label">The Purpose</span>
            <p>
                Some places hold answers. This one holds possibilities. The experiences gathered here aren't ordinary—they're the ones that rewrote lives. The fears aren't weaknesses—they're shared by those who dared to face them and were shaped through their fire. Come when you're searching. Leave with a new way of seeing.
            </p>

            <a href="share-your-story.html" class="cta">
                Share your story
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a>
        </section>
    </main>

    <div id="footer"></div>

    <!-- jQuery (required for turn.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Turn.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>

    <script src="js/components.js"></script>
    <script src="js/stories.js"></script>
    <script>
        let currentIndex = 0;
        let stories = [];
        let flipbookInitialized = false;

        // Generate pages HTML for flipbook
        function generateFlipbookPages() {
            const flipbook = $('#flipbook');
            flipbook.empty();

            // Page 1: Front cover
            flipbook.append(`
                <div class="hard cover-front">
                    <div class="page-content">
                        <h2>The Book<br><span style="font-style: italic; font-size: 0.7em;">of</span><br>Experience</h2>
                    </div>
                </div>
            `);

            // Story pages - each story is a spread (2 pages: experience left, fear right)
            stories.forEach((story, index) => {
                // Left page - Experience
                flipbook.append(`
                    <div>
                        <div class="page-content">
                            <h2 class="page-question">What is the best experience you would gift someone?</h2>
                            <p class="page-answer">${story.experience}</p>
                            <p class="page-author">${formatAuthor(story)}</p>
                        </div>
                    </div>
                `);

                // Right page - Fear
                flipbook.append(`
                    <div>
                        <div class="page-content">
                            <h2 class="page-question">What is your biggest fear?</h2>
                            <p class="page-answer">${story.fear}</p>
                            <p class="page-author">${formatAuthor(story)}</p>
                        </div>
                    </div>
                `);
            });

            // Back cover
            flipbook.append(`
                <div class="hard cover-back">
                    <div class="page-content">
                        <h2 style="font-size: 1.2rem;">Share Your Story</h2>
                    </div>
                </div>
            `);
        }

        // Initialize turn.js flipbook
        function initFlipbook() {
            if (flipbookInitialized || window.innerWidth < 900) return;

            generateFlipbookPages();

            $('#flipbook').turn({
                width: 848,
                height: 600,
                autoCenter: true,
                elevation: 80,
                gradients: true,
                acceleration: true,
                duration: 1200,
                display: 'double',
                page: 1,
                when: {
                    turned: function(event, page) {
                        // Page 1 = cover, pages 2-3 = story 0, pages 4-5 = story 1, etc.
                        if (page === 1) {
                            currentIndex = -1; // On cover
                        } else {
                            currentIndex = Math.floor((page - 2) / 2);
                        }
                        updateNavButtons();
                    }
                }
            });

            flipbookInitialized = true;
            updateNavButtons();
        }

        // Mobile fallback functions
        function displayStory(index, animate = true) {
            const story = stories[index];
            if (!story) return;

            const book = document.getElementById('book');

            if (animate) {
                book.classList.add('turning');
                setTimeout(() => updateStoryContent(story, book), 300);
            } else {
                updateStoryContent(story, book);
            }
        }

        function updateStoryContent(story, book) {
            document.getElementById('experience-text').textContent = story.experience;
            document.getElementById('fear-text').textContent = story.fear;
            document.getElementById('author-left').textContent = formatAuthor(story);
            document.getElementById('author-right').textContent = formatAuthor(story);
            book.classList.remove('turning');
            updateNavButtons();
        }

        function updateNavButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            if (flipbookInitialized && window.innerWidth >= 900) {
                var currentPage = $('#flipbook').turn('page');
                var totalPages = $('#flipbook').turn('pages');
                // Disable prev on cover (page 1)
                if (prevBtn) prevBtn.disabled = currentPage <= 1;
                // Disable next on last story (before back cover)
                if (nextBtn) nextBtn.disabled = currentPage >= totalPages - 1;
            } else {
                if (prevBtn) prevBtn.disabled = currentIndex === 0;
                if (nextBtn) nextBtn.disabled = currentIndex === stories.length - 1;
            }
        }

        function nextStory() {
            if (flipbookInitialized && window.innerWidth >= 900) {
                var currentPage = $('#flipbook').turn('page');
                var totalPages = $('#flipbook').turn('pages');

                if (currentPage === 1) {
                    // On cover, open to first story (page 2-3)
                    $('#flipbook').turn('page', 3);
                } else {
                    // Turn 2 pages to go to next story spread
                    var nextSpread = currentPage + 2;
                    if (nextSpread < totalPages) {
                        $('#flipbook').turn('page', nextSpread);
                    }
                }
            } else {
                if (currentIndex >= stories.length - 1) return;
                currentIndex++;
                displayStory(currentIndex);
            }
        }

        function prevStory() {
            if (flipbookInitialized && window.innerWidth >= 900) {
                var currentPage = $('#flipbook').turn('page');

                if (currentPage <= 3) {
                    // On first story, go back to cover
                    $('#flipbook').turn('page', 1);
                } else {
                    // Turn back 2 pages to go to previous story spread
                    var prevSpread = currentPage - 2;
                    $('#flipbook').turn('page', prevSpread);
                }
            } else {
                if (currentIndex <= 0) return;
                currentIndex--;
                displayStory(currentIndex);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            stories = getStoriesWithDefault();
            displayStory(0, false);

            document.getElementById('next-btn').addEventListener('click', nextStory);
            document.getElementById('prev-btn').addEventListener('click', prevStory);

            // Initialize flipbook after a short delay to ensure DOM is ready
            setTimeout(initFlipbook, 100);

            // Reinitialize on resize
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    if (window.innerWidth >= 900 && !flipbookInitialized) {
                        initFlipbook();
                    }
                }, 250);
            });
        });
    </script>

</body>
</html>
